<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <title>Home</title>
        <link rel="icon" href="../../icon.ico">
    </head>
    <body style="width:100%">
        <div id="picker" style="display: none;"></div>
        <div id="bigPopup">
            <div id="popup">
                <p>press esc to exit</p>
            </div>
        </div>
            
        </div>
        <div class="bar">
            <div>
                <a href="../lessons/">My lessons</a>
                <a>My assignments</a>
            </div>
            <button onclick="window.location.href = '../../create/'" id="create-lesson">create lesson</button>
        </div>
        <div class="lessons" id="lessons">
        </div>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
            import { getFirestore, collection, addDoc, query, where, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-firestore.js";
            import { getAuth } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";

            const firebaseApp = initializeApp({
                apiKey: "AIzaSyCp7hFFVEOTQhya1YTpmlDLXEzoBJ7HWzQ",
                authDomain: "sentensi-4aedd.firebaseapp.com",
                projectId: "sentensi-4aedd",
                storageBucket: "sentensi-4aedd.appspot.com",
                messagingSenderId: "927772530939",
                appId: "1:927772530939:web:eeb1d50bc68f48aa4b785e",
                measurementId: "G-CGTFDKKXDF"
            });

            const db = getFirestore(firebaseApp);
            const auth = getAuth(firebaseApp);

            auth.onAuthStateChanged(function (user){
                if (user == null){
                    window.location.href = '../../logup';
                }
            });

            var selectedActivity = "";

            auth.onAuthStateChanged(async function (user){
                const data = await getDocs(collection(db, "Activities"));
                data.docs.forEach(cls => {
                    let id = cls.id;
                    cls = cls.data();
                    document.getElementById('lessons').innerHTML += `
                    <div class="lesson">
                        <div style="background-color: #2929bb; border-top-right-radius: 5px; border-top-left-radius: 5px;">
                            <h5 style="padding-top: 10px; padding-bottom:10px; margin-top:0;">${id}</h5>
                        </div>
                        <div style="display: flex; justify-content: center; flex-direction: column;">
                            <button id="${id}" class="enter" style="margin-top:20px;">See results</button>
                            <p style="margin-bottom:0px;">Class link:</p>
                            <a style="margin-top: 3px; margin-bottom:3px; overflow:hidden;" onclick="navigator.clipboard.writeText(this.innerText); console.log('Content copied to clipboard');")">https://sentensi.com/play/?q=${id}</a>
                            <p style="margin-top:0px; text-align: center;">(click to copy)</p>
                        </div>
                    </div>
                    `;
                });
                let buttons = document.getElementsByClassName('enter');
                for (let i = 0; i < buttons.length; i++){
                    let cls = data.docs[i].data();
                    buttons[i].onclick = function(){
                        document.getElementById('bigPopup').style.display = 'flex';
                        var ht = `
                        <table>
                            <tr>
                                <td>Name</td>
                                <td>Right</td>
                                <td>Wrong</td>
                                <td>Tries</td>
                                <td>Time</td>
                            </tr>
                        `
                        let keys = Object.keys(cls.scores);
                        for (let i = 0; i < keys.length; i++){
                            if (keys[i] != "target"){
                                ht += `
                                <tr>
                                    <td>${keys[i]}</td>
                                    <td>${cls.scores[keys[i]][0]}</td>
                                    <td>${cls.scores[keys[i]][1]}</td>
                                    <td>${cls.scores[keys[i]][2]}</td>
                                    <td>${cls.scores[keys[i]][3]}</td>
                                </tr>
                                `
                            }
                        }
                        ht += `</tables>`;
                        document.getElementById('popup').innerHTML += ht;
                    }
                }
            });

            var studentList = [];

            document.addEventListener("keydown", function (e){
                if (e.key == 'Escape'){
                    document.getElementById('bigPopup').style.display = 'none';
                }
            });
        </script>
    </body>
</html>