<!DOCTYPE html>
<html>
    <head>
        <script type="module" src="../../init.js"></script>
        <link rel="stylesheet" href="style.css">
        <title>Home</title>
        <link rel="icon" href="../../icon.ico">
    </head>
    <body style="width:100%">
        <div id="picker" style="display: none;"></div>
        <div id="popup">
            <div style="background-color: white; border-radius: 3vw; display: flex; flex-direction: column; padding: 2vw;">
                <h1 id="setTarget"></h1>
                <input id="name" placeholder="activity name">
                <button id="create" style="margin-top: 1vh;">Create</button>
            </div>
        </div>
        <div class="bar">
            <div>
                <a>My lessons</a>
                <a>My assignments</a>
            </div>
            <button onclick="window.location.href = '../../create/'" id="create-lesson">create lesson</button>
        </div>
        <div class="lessons" id="lessons">
        </div>
        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
            import { getFirestore, collection, setDoc, query, where, getDocs, doc } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-firestore.js";
            import { getAuth } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-auth.js";

            const firebaseApp = initializeApp({
                apiKey: "AIzaSyCp7hFFVEOTQhya1YTpmlDLXEzoBJ7HWzQ",
                authDomain: "sentensi-4aedd.firebaseapp.com",
                projectId: "sentensi-4aedd",
                storageBucket: "sentensi-4aedd.appspot.com",
                messagingSenderId: "927772530939",
                appId: "1:927772530939:web:eeb1d50bc68f48aa4b785e",
                measurementId: "G-CGTFDKKXDF"
            });

            const db = getFirestore(firebaseApp);
            const auth = getAuth(firebaseApp);

            auth.onAuthStateChanged(async function (user){
                const data = await getDocs(collection(db, "tempWork"));
                console.log(data.docs[0])
                data.docs.forEach(cls => {
                    let id = cls.id;
                    cls = cls.data();
                    document.getElementById('lessons').innerHTML += `
                    <div class="lesson">
                        <div style="background-color: #2929bb; border-top-right-radius: 5px; border-top-left-radius: 5px;">
                            <h5 style="margin-top: 0px;">${id}</h5>
                        </div>
                        <div style="display: flex; justify-content: center; flex-direction: column;">
                            <button class="enter" onclick = window.location.href="https://sentensi.com/create/?q=${id}" style="margin-top: 1vh;">Edit lesson</button>
                            <p style="margin-bottom:0px;">Class link:</p>
                            <a style="margin-top: 3px; margin-bottom:3px; overflow:hidden;" onclick="navigator.clipboard.writeText(this.innerText); console.log('Content copied to clipboard');")">https://sentensi.com/create/?q=${id}</a>
                            <p style="margin-top:0px; text-align: center;">(click to copy)</p>
                            <button class="enter" onclick="document.getElementById('setTarget').innerHTML = '${id}'; document.getElementById('popup').style.display = 'flex'" style="margin-bottom: 1vh;">Set as activity</button>
                        </div>
                    </div>
                    `
                });
            });

            var studentList = [];

            document.addEventListener("keydown", function (e){
                if (e.key == 'Escape'){
                    document.getElementById('addWindow').style.display = 'none';
                }
            });

            document.getElementById('create').onclick = function(){
                setDoc(doc(db, "Activities/", document.getElementById('name').value), {target: document.getElementById('setTarget').innerHTML}).then(p => {
                    window.location.reload();
                });
            }
        </script>
    </body>
</html>